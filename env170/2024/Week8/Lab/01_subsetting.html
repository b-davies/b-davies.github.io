<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Week 8 Lab: Cleaning, Tidying, and Wrangling Data - 1&nbsp; Getting started with wrangling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./02_reordering.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01_subsetting.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting started with wrangling</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Week 8 Lab: Cleaning, Tidying, and Wrangling Data</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_subsetting.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting started with wrangling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_reordering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Transforming data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_tidying.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tidying data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./LabExercise8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 8 Lab Exercise</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introducing-dplyr" id="toc-introducing-dplyr" class="nav-link active" data-scroll-target="#introducing-dplyr">Introducing <code>dplyr</code></a></li>
  <li><a href="#subsetting" id="toc-subsetting" class="nav-link" data-scroll-target="#subsetting">Subsetting</a></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter">Filter</a></li>
  <li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select">Select</a></li>
  <li><a href="#slice" id="toc-slice" class="nav-link" data-scroll-target="#slice">Slice</a></li>
  <li><a href="#distinct" id="toc-distinct" class="nav-link" data-scroll-target="#distinct">Distinct</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting started with wrangling</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Data wrangling includes operations aimed at manipulating data into a clearer or more useful form. This may be for restructuring data into forms that are usable as arguments in analytical functions, transforming values to facilitate visualizations, creating polished data for use by the public, or even just to clarify the look and structure of the data for your own benefit. The kinds of operations that might be undertaken depend on what the data looks like in its raw (received) state. However, there are some common operations that have been built into the packages that make up the tidyverse, and we’ll explore some here.</p>
<section id="introducing-dplyr" class="level3">
<h3 class="anchored" data-anchor-id="introducing-dplyr">Introducing <code>dplyr</code></h3>
<p>The dplyr (dee-ply-er) package contains a set of tools designed principally for activities associated with data wrangling. These tools follow a sort of grammar, whereby the name of the function relates directly to what it does to the data (e.g., <code>filter</code> “filters”, <code>select</code> “selects”, etc.). The function name is followed by arguments that follow a general structure:</p>
<ul>
<li><p>The first argument in a <code>dyplr</code> function is always a table (e.g., tibble, data frame)</p></li>
<li><p>Further arguments describe operations on columns in that table (with column names that are expressed without <code>$</code> or quotes)</p></li>
<li><p>The result is always a table</p></li>
</ul>
<p>There’s a few reasons why you might want to use these functions. The first is code clarity: most of the operations we’ve done so far use operators specific to Base R (e.g., <code>$</code>), whereas these have more intuitive names and follow the same patterns across their usage (helping with code readability). Another is that the <code>dplyr</code> tools have been designed specifically with data wrangling in mind, and so contain a number of options and integration that allow for smoother transitions between data states and, ultimately, fewer lines of code.</p>
<p>To illustrate how these work, we’ll start by going through some of the functions used to create subsets of data.</p>
</section>
<section id="subsetting" class="level3">
<h3 class="anchored" data-anchor-id="subsetting">Subsetting</h3>
<p>Oftentimes, the data we receive may have more variables, observations, or values than we would like. Let’s look at the tree inventory dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>treeData<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">"data/TS3_Raw_tree_data.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>treeData</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14,487 × 41
   DbaseID Region City   Source TreeID Zone  `Park/Street` SpCode ScientificName
     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;         
 1       1 InlVal Modes… Motow…      1 Nurs… Nursery       ACSA1  Acer sacchari…
 2       2 InlVal Modes… Motow…      2 Nurs… Nursery       BEPE   Betula pendula
 3       3 InlVal Modes… Motow…      3 Nurs… Nursery       CESI4  Celtis sinens…
 4       4 InlVal Modes… Motow…      4 Nurs… Nursery       CICA   Cinnamomum ca…
 5       5 InlVal Modes… Motow…      5 Nurs… Nursery       FRAN_R Fraxinus angu…
 6       6 InlVal Modes… Motow…      6 Nurs… Nursery       FREX_H Fraxinus exce…
 7       7 InlVal Modes… Motow…      7 Nurs… Nursery       FRHO   Fraxinus holo…
 8       8 InlVal Modes… Motow…      8 Nurs… Nursery       FRPE_M Fraxinus penn…
 9       9 InlVal Modes… Motow…      9 Nurs… Nursery       FRVE_G Fraxinus velu…
10      10 InlVal Modes… Motow…     10 Nurs… Nursery       GIBI   Ginkgo biloba 
# ℹ 14,477 more rows
# ℹ 32 more variables: CommonName &lt;chr&gt;, TreeType &lt;chr&gt;, address &lt;chr&gt;,
#   street &lt;chr&gt;, side &lt;chr&gt;, cell &lt;dbl&gt;, OnStreet &lt;chr&gt;, FromStreet &lt;chr&gt;,
#   ToStreet &lt;chr&gt;, Age &lt;dbl&gt;, `DBH (cm)` &lt;dbl&gt;, `TreeHt (m)` &lt;dbl&gt;,
#   CrnBase &lt;dbl&gt;, `CrnHt (m)` &lt;dbl&gt;, `CdiaPar (m)` &lt;dbl&gt;,
#   `CDiaPerp (m)` &lt;dbl&gt;, `AvgCdia (m)` &lt;dbl&gt;, `Leaf (m2)` &lt;dbl&gt;,
#   Setback &lt;dbl&gt;, TreeOr &lt;dbl&gt;, CarShade &lt;dbl&gt;, LandUse &lt;dbl&gt;, Shape &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Here, we have over 14,000 observations across 41 different variables. There are both practical and analytic reasons you might want to subset this dataset. For example, if you have to regularly refer to a few columns, it may get frustrating to have to keep scrolling across them or calling for a list of column names. Or maybe you are being hired to work on a question about trees in a specific city, and the values from the others are superfluous to your needs. Let’s look at a few functions that can help us address these by subsetting the data into smaller packages.</p>
</section>
<section id="filter" class="level3">
<h3 class="anchored" data-anchor-id="filter">Filter</h3>
<p>The <code>filter</code> function subsets the data according to a given set of criteria. So, carrying on from our last example, let’s say you were doing an analysis of street trees in Modesto, California:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(treeData,City<span class="sc">==</span><span class="st">"Modesto, CA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 634 × 41
   DbaseID Region City   Source TreeID Zone  `Park/Street` SpCode ScientificName
     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;         
 1       1 InlVal Modes… Motow…      1 Nurs… Nursery       ACSA1  Acer sacchari…
 2       2 InlVal Modes… Motow…      2 Nurs… Nursery       BEPE   Betula pendula
 3       3 InlVal Modes… Motow…      3 Nurs… Nursery       CESI4  Celtis sinens…
 4       4 InlVal Modes… Motow…      4 Nurs… Nursery       CICA   Cinnamomum ca…
 5       5 InlVal Modes… Motow…      5 Nurs… Nursery       FRAN_R Fraxinus angu…
 6       6 InlVal Modes… Motow…      6 Nurs… Nursery       FREX_H Fraxinus exce…
 7       7 InlVal Modes… Motow…      7 Nurs… Nursery       FRHO   Fraxinus holo…
 8       8 InlVal Modes… Motow…      8 Nurs… Nursery       FRPE_M Fraxinus penn…
 9       9 InlVal Modes… Motow…      9 Nurs… Nursery       FRVE_G Fraxinus velu…
10      10 InlVal Modes… Motow…     10 Nurs… Nursery       GIBI   Ginkgo biloba 
# ℹ 624 more rows
# ℹ 32 more variables: CommonName &lt;chr&gt;, TreeType &lt;chr&gt;, address &lt;chr&gt;,
#   street &lt;chr&gt;, side &lt;chr&gt;, cell &lt;dbl&gt;, OnStreet &lt;chr&gt;, FromStreet &lt;chr&gt;,
#   ToStreet &lt;chr&gt;, Age &lt;dbl&gt;, `DBH (cm)` &lt;dbl&gt;, `TreeHt (m)` &lt;dbl&gt;,
#   CrnBase &lt;dbl&gt;, `CrnHt (m)` &lt;dbl&gt;, `CdiaPar (m)` &lt;dbl&gt;,
#   `CDiaPerp (m)` &lt;dbl&gt;, `AvgCdia (m)` &lt;dbl&gt;, `Leaf (m2)` &lt;dbl&gt;,
#   Setback &lt;dbl&gt;, TreeOr &lt;dbl&gt;, CarShade &lt;dbl&gt;, LandUse &lt;dbl&gt;, Shape &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Quite clear, yes? The first argument is a table (the treeData tibble), and the second is criteria referring to the <strong>City</strong> column. The result is another table, but this one only containing observations from Modesto.</p>
<p>By itself, this works precisely the same as selecting using the <code>$</code> operator and square brackets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>treeData[treeData<span class="sc">$</span>City<span class="sc">==</span><span class="st">"Modesto, CA"</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 634 × 41
   DbaseID Region City   Source TreeID Zone  `Park/Street` SpCode ScientificName
     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;         
 1       1 InlVal Modes… Motow…      1 Nurs… Nursery       ACSA1  Acer sacchari…
 2       2 InlVal Modes… Motow…      2 Nurs… Nursery       BEPE   Betula pendula
 3       3 InlVal Modes… Motow…      3 Nurs… Nursery       CESI4  Celtis sinens…
 4       4 InlVal Modes… Motow…      4 Nurs… Nursery       CICA   Cinnamomum ca…
 5       5 InlVal Modes… Motow…      5 Nurs… Nursery       FRAN_R Fraxinus angu…
 6       6 InlVal Modes… Motow…      6 Nurs… Nursery       FREX_H Fraxinus exce…
 7       7 InlVal Modes… Motow…      7 Nurs… Nursery       FRHO   Fraxinus holo…
 8       8 InlVal Modes… Motow…      8 Nurs… Nursery       FRPE_M Fraxinus penn…
 9       9 InlVal Modes… Motow…      9 Nurs… Nursery       FRVE_G Fraxinus velu…
10      10 InlVal Modes… Motow…     10 Nurs… Nursery       GIBI   Ginkgo biloba 
# ℹ 624 more rows
# ℹ 32 more variables: CommonName &lt;chr&gt;, TreeType &lt;chr&gt;, address &lt;chr&gt;,
#   street &lt;chr&gt;, side &lt;chr&gt;, cell &lt;dbl&gt;, OnStreet &lt;chr&gt;, FromStreet &lt;chr&gt;,
#   ToStreet &lt;chr&gt;, Age &lt;dbl&gt;, `DBH (cm)` &lt;dbl&gt;, `TreeHt (m)` &lt;dbl&gt;,
#   CrnBase &lt;dbl&gt;, `CrnHt (m)` &lt;dbl&gt;, `CdiaPar (m)` &lt;dbl&gt;,
#   `CDiaPerp (m)` &lt;dbl&gt;, `AvgCdia (m)` &lt;dbl&gt;, `Leaf (m2)` &lt;dbl&gt;,
#   Setback &lt;dbl&gt;, TreeOr &lt;dbl&gt;, CarShade &lt;dbl&gt;, LandUse &lt;dbl&gt;, Shape &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>So why bother with <code>filter</code>? Why not just stick with square brackets? This function enables us to make more complex subsets with less code, and the code that it produces is ultimately more readable. We can get a feel for this by asking for additional information. For example, let’s say we wanted to look at data from Modesto <em>and</em> Sacramento. With <code>filter</code>, it would look something like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(treeData,City <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Modesto, CA"</span>,<span class="st">"Sacramento, CA"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,635 × 41
   DbaseID Region City   Source TreeID Zone  `Park/Street` SpCode ScientificName
     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;         
 1       1 InlVal Modes… Motow…      1 Nurs… Nursery       ACSA1  Acer sacchari…
 2       2 InlVal Modes… Motow…      2 Nurs… Nursery       BEPE   Betula pendula
 3       3 InlVal Modes… Motow…      3 Nurs… Nursery       CESI4  Celtis sinens…
 4       4 InlVal Modes… Motow…      4 Nurs… Nursery       CICA   Cinnamomum ca…
 5       5 InlVal Modes… Motow…      5 Nurs… Nursery       FRAN_R Fraxinus angu…
 6       6 InlVal Modes… Motow…      6 Nurs… Nursery       FREX_H Fraxinus exce…
 7       7 InlVal Modes… Motow…      7 Nurs… Nursery       FRHO   Fraxinus holo…
 8       8 InlVal Modes… Motow…      8 Nurs… Nursery       FRPE_M Fraxinus penn…
 9       9 InlVal Modes… Motow…      9 Nurs… Nursery       FRVE_G Fraxinus velu…
10      10 InlVal Modes… Motow…     10 Nurs… Nursery       GIBI   Ginkgo biloba 
# ℹ 1,625 more rows
# ℹ 32 more variables: CommonName &lt;chr&gt;, TreeType &lt;chr&gt;, address &lt;chr&gt;,
#   street &lt;chr&gt;, side &lt;chr&gt;, cell &lt;dbl&gt;, OnStreet &lt;chr&gt;, FromStreet &lt;chr&gt;,
#   ToStreet &lt;chr&gt;, Age &lt;dbl&gt;, `DBH (cm)` &lt;dbl&gt;, `TreeHt (m)` &lt;dbl&gt;,
#   CrnBase &lt;dbl&gt;, `CrnHt (m)` &lt;dbl&gt;, `CdiaPar (m)` &lt;dbl&gt;,
#   `CDiaPerp (m)` &lt;dbl&gt;, `AvgCdia (m)` &lt;dbl&gt;, `Leaf (m2)` &lt;dbl&gt;,
#   Setback &lt;dbl&gt;, TreeOr &lt;dbl&gt;, CarShade &lt;dbl&gt;, LandUse &lt;dbl&gt;, Shape &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>We’ve learned how to do this similarly in Base R:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>treeData[treeData<span class="sc">$</span>City <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Modesto, CA"</span>, <span class="st">"Sacramento, CA"</span>),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,635 × 41
   DbaseID Region City   Source TreeID Zone  `Park/Street` SpCode ScientificName
     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;         
 1       1 InlVal Modes… Motow…      1 Nurs… Nursery       ACSA1  Acer sacchari…
 2       2 InlVal Modes… Motow…      2 Nurs… Nursery       BEPE   Betula pendula
 3       3 InlVal Modes… Motow…      3 Nurs… Nursery       CESI4  Celtis sinens…
 4       4 InlVal Modes… Motow…      4 Nurs… Nursery       CICA   Cinnamomum ca…
 5       5 InlVal Modes… Motow…      5 Nurs… Nursery       FRAN_R Fraxinus angu…
 6       6 InlVal Modes… Motow…      6 Nurs… Nursery       FREX_H Fraxinus exce…
 7       7 InlVal Modes… Motow…      7 Nurs… Nursery       FRHO   Fraxinus holo…
 8       8 InlVal Modes… Motow…      8 Nurs… Nursery       FRPE_M Fraxinus penn…
 9       9 InlVal Modes… Motow…      9 Nurs… Nursery       FRVE_G Fraxinus velu…
10      10 InlVal Modes… Motow…     10 Nurs… Nursery       GIBI   Ginkgo biloba 
# ℹ 1,625 more rows
# ℹ 32 more variables: CommonName &lt;chr&gt;, TreeType &lt;chr&gt;, address &lt;chr&gt;,
#   street &lt;chr&gt;, side &lt;chr&gt;, cell &lt;dbl&gt;, OnStreet &lt;chr&gt;, FromStreet &lt;chr&gt;,
#   ToStreet &lt;chr&gt;, Age &lt;dbl&gt;, `DBH (cm)` &lt;dbl&gt;, `TreeHt (m)` &lt;dbl&gt;,
#   CrnBase &lt;dbl&gt;, `CrnHt (m)` &lt;dbl&gt;, `CdiaPar (m)` &lt;dbl&gt;,
#   `CDiaPerp (m)` &lt;dbl&gt;, `AvgCdia (m)` &lt;dbl&gt;, `Leaf (m2)` &lt;dbl&gt;,
#   Setback &lt;dbl&gt;, TreeOr &lt;dbl&gt;, CarShade &lt;dbl&gt;, LandUse &lt;dbl&gt;, Shape &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>This doesn’t seem so different; however, when you’re working with square brackets, you need to remember to include the comma at the end of the statement to indicate that you are subsetting <em>row-wise</em>. Woe be it to those who forget that precious comma.</p>
<p>OK, let’s try something a little more complicated: what if we wanted to filter to all the <em>maple</em> trees in Modesto? Here, we can combine our <code>dplyr</code> code with a helper function from elsewhere in the tidyverse: the <code>str_detect</code> function from the <code>stringr</code> package. This will detect whether a text string we provide matches anywhere in another text string.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>modestoMaples<span class="ot">&lt;-</span><span class="fu">filter</span>(treeData,City<span class="sc">==</span><span class="st">"Modesto, CA"</span> <span class="sc">&amp;</span> <span class="fu">str_detect</span>(CommonName,<span class="st">"maple"</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>modestoMaples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 29 × 41
   DbaseID Region City   Source TreeID Zone  `Park/Street` SpCode ScientificName
     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;         
 1       1 InlVal Modes… Motow…      1 Nurs… Nursery       ACSA1  Acer sacchari…
 2      43 InlVal Modes… Motow…   2961 -1    -1            ACSA1  Acer sacchari…
 3      96 InlVal Modes… Motow…   9733 -1    -1            ACSA1  Acer sacchari…
 4     306 InlVal Modes… Motow…  31877 -1    -1            ACSA1  Acer sacchari…
 5     309 InlVal Modes… Motow…  32147 -1    -1            ACSA1  Acer sacchari…
 6     310 InlVal Modes… Motow…  32193 -1    -1            ACSA1  Acer sacchari…
 7     314 InlVal Modes… Motow…  32333 -1    -1            ACSA1  Acer sacchari…
 8     318 InlVal Modes… Motow…  33269 -1    -1            ACSA1  Acer sacchari…
 9     324 InlVal Modes… Motow…  34001 -1    -1            ACSA1  Acer sacchari…
10     329 InlVal Modes… Motow…  35120 -1    -1            ACSA1  Acer sacchari…
# ℹ 19 more rows
# ℹ 32 more variables: CommonName &lt;chr&gt;, TreeType &lt;chr&gt;, address &lt;chr&gt;,
#   street &lt;chr&gt;, side &lt;chr&gt;, cell &lt;dbl&gt;, OnStreet &lt;chr&gt;, FromStreet &lt;chr&gt;,
#   ToStreet &lt;chr&gt;, Age &lt;dbl&gt;, `DBH (cm)` &lt;dbl&gt;, `TreeHt (m)` &lt;dbl&gt;,
#   CrnBase &lt;dbl&gt;, `CrnHt (m)` &lt;dbl&gt;, `CdiaPar (m)` &lt;dbl&gt;,
#   `CDiaPerp (m)` &lt;dbl&gt;, `AvgCdia (m)` &lt;dbl&gt;, `Leaf (m2)` &lt;dbl&gt;,
#   Setback &lt;dbl&gt;, TreeOr &lt;dbl&gt;, CarShade &lt;dbl&gt;, LandUse &lt;dbl&gt;, Shape &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Doing this in Base R involves using the <code>grepl</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>modestoMaples<span class="ot">&lt;-</span>treeData[treeData<span class="sc">$</span>City<span class="sc">==</span><span class="st">"Modesto, CA"</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"maple"</span>,treeData<span class="sc">$</span>CommonName),]</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>modestoMaples</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 29 × 41
   DbaseID Region City   Source TreeID Zone  `Park/Street` SpCode ScientificName
     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;         
 1       1 InlVal Modes… Motow…      1 Nurs… Nursery       ACSA1  Acer sacchari…
 2      43 InlVal Modes… Motow…   2961 -1    -1            ACSA1  Acer sacchari…
 3      96 InlVal Modes… Motow…   9733 -1    -1            ACSA1  Acer sacchari…
 4     306 InlVal Modes… Motow…  31877 -1    -1            ACSA1  Acer sacchari…
 5     309 InlVal Modes… Motow…  32147 -1    -1            ACSA1  Acer sacchari…
 6     310 InlVal Modes… Motow…  32193 -1    -1            ACSA1  Acer sacchari…
 7     314 InlVal Modes… Motow…  32333 -1    -1            ACSA1  Acer sacchari…
 8     318 InlVal Modes… Motow…  33269 -1    -1            ACSA1  Acer sacchari…
 9     324 InlVal Modes… Motow…  34001 -1    -1            ACSA1  Acer sacchari…
10     329 InlVal Modes… Motow…  35120 -1    -1            ACSA1  Acer sacchari…
# ℹ 19 more rows
# ℹ 32 more variables: CommonName &lt;chr&gt;, TreeType &lt;chr&gt;, address &lt;chr&gt;,
#   street &lt;chr&gt;, side &lt;chr&gt;, cell &lt;dbl&gt;, OnStreet &lt;chr&gt;, FromStreet &lt;chr&gt;,
#   ToStreet &lt;chr&gt;, Age &lt;dbl&gt;, `DBH (cm)` &lt;dbl&gt;, `TreeHt (m)` &lt;dbl&gt;,
#   CrnBase &lt;dbl&gt;, `CrnHt (m)` &lt;dbl&gt;, `CdiaPar (m)` &lt;dbl&gt;,
#   `CDiaPerp (m)` &lt;dbl&gt;, `AvgCdia (m)` &lt;dbl&gt;, `Leaf (m2)` &lt;dbl&gt;,
#   Setback &lt;dbl&gt;, TreeOr &lt;dbl&gt;, CarShade &lt;dbl&gt;, LandUse &lt;dbl&gt;, Shape &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Compare those last two examples in terms of their readability. The code in the tidyverse version more or less follows a pattern consistent with what you are asking it to do (‘<strong>filter</strong> the <strong>data</strong> to instances where the <strong>city</strong> is <strong>Modesto</strong> and the <strong>common name</strong> includes <strong>“maple”</strong>’). The Base R version is a little less straightforward. It uses redundant references to the name of the dataset (treeData), multiple types of brackets, commas separating both arguments <u>and</u> table dimensions, and sometimes reverses the pattern of inputs (data, argument vs argument, data).</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Try it yourself!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Try writing the following Base R sub-setting routines using the <code>filter</code> function:</p>
<p><code>treeData[treeData$CrnBase&gt;5,]</code></p>
<p><code>treeData[treeData$`Park/Street`!="Park",]</code></p>
<p><code>treeData[treeData$ScientificName=="Pinus radiata" | treeData$ScientificName=="Sequoia sempervirens",]</code></p>
</div>
</div>
<p>It should be made clear, though, that anything you want to do in tidyverse can be done in Base R, and if you ultimately decide you are more comfortable with the Base R syntax then there is no harm using it. However, as you work on more complex analyses, and work with messier data, the methods used in Base R will be more and more dependent on coding conventions that were developed without a data science workflow in mind. This creates opportunities for errors to creep in, such as misplaced commas and brackets, incorrect orders of arguments, etc. The tidyverse grammar offers more straightforward path through the data science. We’ll illustrate these concepts with a few additional functions below.</p>
</section>
<section id="select" class="level3">
<h3 class="anchored" data-anchor-id="select">Select</h3>
<p>The <code>select</code> function allows us to select particular columns to include in a smaller dataset. For example, let’s say that we are interested only in some of the measurements on the trees and less concerned with their location. We can use select by first giving the data table, followed by the names of the columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>treeMetrics<span class="ot">&lt;-</span><span class="fu">select</span>(treeData,DbaseID,ScientificName,<span class="st">`</span><span class="at">DBH (cm)</span><span class="st">`</span>,<span class="st">`</span><span class="at">TreeHt (m)</span><span class="st">`</span>,<span class="st">`</span><span class="at">Leaf (m2)</span><span class="st">`</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>treeMetrics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14,487 × 5
   DbaseID ScientificName                    `DBH (cm)` `TreeHt (m)` `Leaf (m2)`
     &lt;dbl&gt; &lt;chr&gt;                                  &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
 1       1 Acer saccharinum                         2.5          2           2.5
 2       2 Betula pendula                           2.5          1.5         1.9
 3       3 Celtis sinensis                          2.5          1.8         2.2
 4       4 Cinnamomum camphora                      2.5          2           2  
 5       5 Fraxinus angustifolia 'Raywood'          2.5          2           2.2
 6       6 Fraxinus excelsior 'Hessei'              2.5          2           2.2
 7       7 Fraxinus holotricha                      2.5          2           2.2
 8       8 Fraxinus pennsylvanica 'Marshall'        2.5          2           2.2
 9       9 Fraxinus velutina 'Modesto'              2.5          2           2.1
10      10 Ginkgo biloba                            2.5          1.6         1.3
# ℹ 14,477 more rows</code></pre>
</div>
</div>
<p>Note that here we are using the backticks to indicate non-conforming column names (i.e., column names with whitespace or other meaningful symbols in R). Again, we could do this with square brackets by giving it the column indices:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>treeMetrics<span class="ot">&lt;-</span>treeData[,<span class="fu">c</span>(<span class="st">"DbaseID"</span>,<span class="st">"ScientificName"</span>,<span class="st">"DBH (cm)"</span>,<span class="st">"TreeHt (m)"</span>,<span class="st">"Leaf (m2)"</span>)]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>treeMetrics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14,487 × 5
   DbaseID ScientificName                    `DBH (cm)` `TreeHt (m)` `Leaf (m2)`
     &lt;dbl&gt; &lt;chr&gt;                                  &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
 1       1 Acer saccharinum                         2.5          2           2.5
 2       2 Betula pendula                           2.5          1.5         1.9
 3       3 Celtis sinensis                          2.5          1.8         2.2
 4       4 Cinnamomum camphora                      2.5          2           2  
 5       5 Fraxinus angustifolia 'Raywood'          2.5          2           2.2
 6       6 Fraxinus excelsior 'Hessei'              2.5          2           2.2
 7       7 Fraxinus holotricha                      2.5          2           2.2
 8       8 Fraxinus pennsylvanica 'Marshall'        2.5          2           2.2
 9       9 Fraxinus velutina 'Modesto'              2.5          2           2.1
10      10 Ginkgo biloba                            2.5          1.6         1.3
# ℹ 14,477 more rows</code></pre>
</div>
</div>
<p>Since this kind of subsetting requires us to give column names as character values, we don’t need the backticks. But here our argument is a vector of column names inside of square brackets.</p>
<p>The power of <code>select</code> lies in its ability to take additional arguments and interface with helper functions. For example, we can use the <code>starts_with</code> function to request only the columns containing DBH values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>allDBH<span class="ot">&lt;-</span><span class="fu">select</span>(treeData,DbaseID,<span class="fu">starts_with</span>(<span class="st">"dbh"</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>allDBH</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14,487 × 10
   DbaseID `DBH (cm)`  dbh1  dbh2  dbh3  dbh4  dbh5  dbh6  dbh7  dbh8
     &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1       1        2.5   2.5    -1    -1    -1    -1    -1    -1    -1
 2       2        2.5   2.5    -1    -1    -1    -1    -1    -1    -1
 3       3        2.5   2.5    -1    -1    -1    -1    -1    -1    -1
 4       4        2.5   2.5    -1    -1    -1    -1    -1    -1    -1
 5       5        2.5   2.5    -1    -1    -1    -1    -1    -1    -1
 6       6        2.5   2.5    -1    -1    -1    -1    -1    -1    -1
 7       7        2.5   2.5    -1    -1    -1    -1    -1    -1    -1
 8       8        2.5   2.5    -1    -1    -1    -1    -1    -1    -1
 9       9        2.5   2.5    -1    -1    -1    -1    -1    -1    -1
10      10        2.5   2.5    -1    -1    -1    -1    -1    -1    -1
# ℹ 14,477 more rows</code></pre>
</div>
</div>
<p>The <code>starts_with</code> function actually comes from the <strong>tidyselect</strong> package, which is also loaded as part of <strong>tidyverse</strong>. We can also add additional arguments to this call to refine it. For example, we can use <code>ignore.case</code> to not include the first column with DBH (the overall DBH measurement) where it is in all capitals and only keep the individual stem measurements that use lower case:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>allDBH<span class="ot">&lt;-</span><span class="fu">select</span>(treeData,DbaseID,<span class="fu">starts_with</span>(<span class="st">"dbh"</span>,<span class="at">ignore.case =</span> <span class="cn">FALSE</span>))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>allDBH</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14,487 × 9
   DbaseID  dbh1  dbh2  dbh3  dbh4  dbh5  dbh6  dbh7  dbh8
     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1       1   2.5    -1    -1    -1    -1    -1    -1    -1
 2       2   2.5    -1    -1    -1    -1    -1    -1    -1
 3       3   2.5    -1    -1    -1    -1    -1    -1    -1
 4       4   2.5    -1    -1    -1    -1    -1    -1    -1
 5       5   2.5    -1    -1    -1    -1    -1    -1    -1
 6       6   2.5    -1    -1    -1    -1    -1    -1    -1
 7       7   2.5    -1    -1    -1    -1    -1    -1    -1
 8       8   2.5    -1    -1    -1    -1    -1    -1    -1
 9       9   2.5    -1    -1    -1    -1    -1    -1    -1
10      10   2.5    -1    -1    -1    -1    -1    -1    -1
# ℹ 14,477 more rows</code></pre>
</div>
</div>
<p>There are several of these helper functions that work in this case:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#columns ending with the word "Name"</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>allNames<span class="ot">&lt;-</span><span class="fu">select</span>(treeData,<span class="fu">ends_with</span>(<span class="st">"Name"</span>,<span class="at">ignore.case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>allNames</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14,487 × 2
   ScientificName                    CommonName          
   &lt;chr&gt;                             &lt;chr&gt;               
 1 Acer saccharinum                  Silver maple        
 2 Betula pendula                    European white birch
 3 Celtis sinensis                   Chinese hackberry   
 4 Cinnamomum camphora               Camphor tree        
 5 Fraxinus angustifolia 'Raywood'   Raywood ash         
 6 Fraxinus excelsior 'Hessei'       Hesse ash           
 7 Fraxinus holotricha               Moraine ash         
 8 Fraxinus pennsylvanica 'Marshall' Marshall ash        
 9 Fraxinus velutina 'Modesto'       Modesto ash         
10 Ginkgo biloba                     Ginkgo              
# ℹ 14,477 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#columns containing the word "Street"</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>allStreet<span class="ot">&lt;-</span><span class="fu">select</span>(treeData,DbaseID,<span class="fu">contains</span>(<span class="st">"Street"</span>,<span class="at">ignore.case =</span> <span class="cn">FALSE</span>))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>allStreet</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14,487 × 5
   DbaseID `Park/Street` OnStreet FromStreet ToStreet
     &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;   
 1       1 Nursery       -1       -1         -1      
 2       2 Nursery       -1       -1         -1      
 3       3 Nursery       -1       -1         -1      
 4       4 Nursery       -1       -1         -1      
 5       5 Nursery       -1       -1         -1      
 6       6 Nursery       -1       -1         -1      
 7       7 Nursery       -1       -1         -1      
 8       8 Nursery       -1       -1         -1      
 9       9 Nursery       -1       -1         -1      
10      10 Nursery       -1       -1         -1      
# ℹ 14,477 more rows</code></pre>
</div>
</div>
<p>Finally, when selecting columns, you also have an opportunity to rename them as you’d prefer, assigning them by entering the new name in quotes (e.g., “LeafArea” and the :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>treeMetrics<span class="ot">&lt;-</span><span class="fu">select</span>(treeData,<span class="st">"ID"</span><span class="ot">=</span>DbaseID,<span class="st">"Name"</span><span class="ot">=</span>ScientificName,<span class="st">"DBH"</span><span class="ot">=</span><span class="st">`</span><span class="at">DBH (cm)</span><span class="st">`</span>,<span class="st">"Height"</span><span class="ot">=</span><span class="st">`</span><span class="at">TreeHt (m)</span><span class="st">`</span>,<span class="st">"LeafArea"</span><span class="ot">=</span><span class="st">`</span><span class="at">Leaf (m2)</span><span class="st">`</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>treeMetrics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14,487 × 5
      ID Name                                DBH Height LeafArea
   &lt;dbl&gt; &lt;chr&gt;                             &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
 1     1 Acer saccharinum                    2.5    2        2.5
 2     2 Betula pendula                      2.5    1.5      1.9
 3     3 Celtis sinensis                     2.5    1.8      2.2
 4     4 Cinnamomum camphora                 2.5    2        2  
 5     5 Fraxinus angustifolia 'Raywood'     2.5    2        2.2
 6     6 Fraxinus excelsior 'Hessei'         2.5    2        2.2
 7     7 Fraxinus holotricha                 2.5    2        2.2
 8     8 Fraxinus pennsylvanica 'Marshall'   2.5    2        2.2
 9     9 Fraxinus velutina 'Modesto'         2.5    2        2.1
10    10 Ginkgo biloba                       2.5    1.6      1.3
# ℹ 14,477 more rows</code></pre>
</div>
</div>
<p>If you only want to rename some columns without selecting a subset of them, you can use the <code>rename</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>treeMetrics<span class="ot">&lt;-</span><span class="fu">rename</span>(treeMetrics,<span class="st">"DBH_cm"</span><span class="ot">=</span>DBH,<span class="st">"Height_m"</span><span class="ot">=</span>Height,<span class="st">"LeafArea_m2"</span><span class="ot">=</span>LeafArea)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>treeMetrics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14,487 × 5
      ID Name                              DBH_cm Height_m LeafArea_m2
   &lt;dbl&gt; &lt;chr&gt;                              &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;
 1     1 Acer saccharinum                     2.5      2           2.5
 2     2 Betula pendula                       2.5      1.5         1.9
 3     3 Celtis sinensis                      2.5      1.8         2.2
 4     4 Cinnamomum camphora                  2.5      2           2  
 5     5 Fraxinus angustifolia 'Raywood'      2.5      2           2.2
 6     6 Fraxinus excelsior 'Hessei'          2.5      2           2.2
 7     7 Fraxinus holotricha                  2.5      2           2.2
 8     8 Fraxinus pennsylvanica 'Marshall'    2.5      2           2.2
 9     9 Fraxinus velutina 'Modesto'          2.5      2           2.1
10    10 Ginkgo biloba                        2.5      1.6         1.3
# ℹ 14,477 more rows</code></pre>
</div>
</div>
</section>
<section id="slice" class="level3">
<h3 class="anchored" data-anchor-id="slice">Slice</h3>
<p>The <code>slice</code> function is used to select a subset of rows using their indices (i.e., row numbers). For example, to get the first 100 rows, you could use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice</span>(treeData,<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 41
   DbaseID Region City   Source TreeID Zone  `Park/Street` SpCode ScientificName
     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;         
 1       1 InlVal Modes… Motow…      1 Nurs… Nursery       ACSA1  Acer sacchari…
 2       2 InlVal Modes… Motow…      2 Nurs… Nursery       BEPE   Betula pendula
 3       3 InlVal Modes… Motow…      3 Nurs… Nursery       CESI4  Celtis sinens…
 4       4 InlVal Modes… Motow…      4 Nurs… Nursery       CICA   Cinnamomum ca…
 5       5 InlVal Modes… Motow…      5 Nurs… Nursery       FRAN_R Fraxinus angu…
 6       6 InlVal Modes… Motow…      6 Nurs… Nursery       FREX_H Fraxinus exce…
 7       7 InlVal Modes… Motow…      7 Nurs… Nursery       FRHO   Fraxinus holo…
 8       8 InlVal Modes… Motow…      8 Nurs… Nursery       FRPE_M Fraxinus penn…
 9       9 InlVal Modes… Motow…      9 Nurs… Nursery       FRVE_G Fraxinus velu…
10      10 InlVal Modes… Motow…     10 Nurs… Nursery       GIBI   Ginkgo biloba 
# ℹ 90 more rows
# ℹ 32 more variables: CommonName &lt;chr&gt;, TreeType &lt;chr&gt;, address &lt;chr&gt;,
#   street &lt;chr&gt;, side &lt;chr&gt;, cell &lt;dbl&gt;, OnStreet &lt;chr&gt;, FromStreet &lt;chr&gt;,
#   ToStreet &lt;chr&gt;, Age &lt;dbl&gt;, `DBH (cm)` &lt;dbl&gt;, `TreeHt (m)` &lt;dbl&gt;,
#   CrnBase &lt;dbl&gt;, `CrnHt (m)` &lt;dbl&gt;, `CdiaPar (m)` &lt;dbl&gt;,
#   `CDiaPerp (m)` &lt;dbl&gt;, `AvgCdia (m)` &lt;dbl&gt;, `Leaf (m2)` &lt;dbl&gt;,
#   Setback &lt;dbl&gt;, TreeOr &lt;dbl&gt;, CarShade &lt;dbl&gt;, LandUse &lt;dbl&gt;, Shape &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>The <code>slice</code> function is actually one of a few different slice-based functions that serve different purposes. For example, the slice_sample allows us to take a random subset of rows from our data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_sample</span>(treeData,<span class="at">n=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 41
   DbaseID Region City   Source TreeID Zone  `Park/Street` SpCode ScientificName
     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;         
 1    7493 NoEast Queen… JFKMa… 318442 411   Street        PLAC   Platanus x ac…
 2    9368 InterW Albuq… ABQMa…  13784 Grav… Park          GLTR   Gleditsia tri…
 3   13671 PacfNW Longv… Longv…   9295 -1    Park          FRLA   Fraxinus lati…
 4    1687 InlEmp Clare… CLMma…  18917 5     -1            SCMO   Schinus molle 
 5     996 SoCalC Santa… SMAMa… 100285 -1    -1            MEEX   Metrosideros …
 6   17691 SacVal Sacra… SMFMa…  44247 Sout… Street        QUAG1  Quercus agrif…
 7    8533 TpIntW Boise… BOIMa…  30983 7A    Street        FRAM   Fraxinus amer…
 8     594 InlVal Modes… Motow…  78936 -1    -1            FRPE_M Fraxinus penn…
 9    4359 NMtnPr Fort … FNLMa…    642 -1    Street        ULPU   Ulmus pumila  
10    5794 LoMidW India… INDMa…    325 E06   -1            FRAM   Fraxinus amer…
# ℹ 90 more rows
# ℹ 32 more variables: CommonName &lt;chr&gt;, TreeType &lt;chr&gt;, address &lt;chr&gt;,
#   street &lt;chr&gt;, side &lt;chr&gt;, cell &lt;dbl&gt;, OnStreet &lt;chr&gt;, FromStreet &lt;chr&gt;,
#   ToStreet &lt;chr&gt;, Age &lt;dbl&gt;, `DBH (cm)` &lt;dbl&gt;, `TreeHt (m)` &lt;dbl&gt;,
#   CrnBase &lt;dbl&gt;, `CrnHt (m)` &lt;dbl&gt;, `CdiaPar (m)` &lt;dbl&gt;,
#   `CDiaPerp (m)` &lt;dbl&gt;, `AvgCdia (m)` &lt;dbl&gt;, `Leaf (m2)` &lt;dbl&gt;,
#   Setback &lt;dbl&gt;, TreeOr &lt;dbl&gt;, CarShade &lt;dbl&gt;, LandUse &lt;dbl&gt;, Shape &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Or we can get the top fifty trees by height using <code>slice_max</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(treeData,<span class="st">`</span><span class="at">TreeHt (m)</span><span class="st">`</span>,<span class="at">n=</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 55 × 41
   DbaseID Region City   Source TreeID Zone  `Park/Street` SpCode ScientificName
     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;         
 1    2665 NoCalC Berke… JBKMa…  29784 1     Park          SESE   Sequoia sempe…
 2   13635 PacfNW Longv… Longv…   8919 -1    Park          POTR2  Populus balsa…
 3    2617 NoCalC Berke… JBKMa…  28535 2     Park          EUGL   Eucalyptus gl…
 4    2636 NoCalC Berke… JBKMa…  28918 2     Park          EUGL   Eucalyptus gl…
 5   11741 Piedmt Charl… CLTMa…  43077 G6    Street        QURU   Quercus rubra 
 6    2614 NoCalC Berke… JBKMa…  28524 2     Park          EUGL   Eucalyptus gl…
 7    2649 NoCalC Berke… JBKMa…  29288 2     Park          SESE   Sequoia sempe…
 8    2840 NoCalC Berke… JBKMa…  70598 1     Park          EUGL   Eucalyptus gl…
 9   12252 Piedmt Charl… CLTMa… 125399 F6    Street        QUAL   Quercus alba  
10   13658 PacfNW Longv… Longv…   9192 -1    Park          POTR2  Populus balsa…
# ℹ 45 more rows
# ℹ 32 more variables: CommonName &lt;chr&gt;, TreeType &lt;chr&gt;, address &lt;chr&gt;,
#   street &lt;chr&gt;, side &lt;chr&gt;, cell &lt;dbl&gt;, OnStreet &lt;chr&gt;, FromStreet &lt;chr&gt;,
#   ToStreet &lt;chr&gt;, Age &lt;dbl&gt;, `DBH (cm)` &lt;dbl&gt;, `TreeHt (m)` &lt;dbl&gt;,
#   CrnBase &lt;dbl&gt;, `CrnHt (m)` &lt;dbl&gt;, `CdiaPar (m)` &lt;dbl&gt;,
#   `CDiaPerp (m)` &lt;dbl&gt;, `AvgCdia (m)` &lt;dbl&gt;, `Leaf (m2)` &lt;dbl&gt;,
#   Setback &lt;dbl&gt;, TreeOr &lt;dbl&gt;, CarShade &lt;dbl&gt;, LandUse &lt;dbl&gt;, Shape &lt;dbl&gt;, …</code></pre>
</div>
</div>
</section>
<section id="distinct" class="level3">
<h3 class="anchored" data-anchor-id="distinct">Distinct</h3>
<p>A last function worth mentioning for subsetting is the <code>distinct</code> function. As you might imagine, this pulls all unique values from a given column in a dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">distinct</span>(treeData,City)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 17 × 1
   City            
   &lt;chr&gt;           
 1 Modesto, CA     
 2 Santa Monica, CA
 3 Claremont, CA   
 4 Berkeley, CA    
 5 Glendale, AZ    
 6 Fort Collins, CO
 7 Minneapolis, MN 
 8 Indianapolis, IN
 9 Queens, NY      
10 Boise, ID       
11 Albuquerque, NM 
12 Honolulu, HI    
13 Charleston, SC  
14 Charlotte, NC   
15 Orlando, FL     
16 Longview, WA    
17 Sacramento, CA  </code></pre>
</div>
</div>
<p>This can be used with multiple columns to get the unique combinations of variables present in the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">distinct</span>(treeData,City,CommonName)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 357 × 2
   City        CommonName          
   &lt;chr&gt;       &lt;chr&gt;               
 1 Modesto, CA Silver maple        
 2 Modesto, CA European white birch
 3 Modesto, CA Chinese hackberry   
 4 Modesto, CA Camphor tree        
 5 Modesto, CA Raywood ash         
 6 Modesto, CA Hesse ash           
 7 Modesto, CA Moraine ash         
 8 Modesto, CA Marshall ash        
 9 Modesto, CA Modesto ash         
10 Modesto, CA Ginkgo              
# ℹ 347 more rows</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Try it yourself!
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can quickly get a complex subset by combining some of these functions. Using the tree data and the functions above, create the following datasets:</p>
<ul>
<li><p>The database ID and all columns measured in meters for all trees in the <em>Quercus</em> genus</p></li>
<li><p>The database ID, Common Name, and DBH of the top 200 trees by leaf area in California</p></li>
<li><p>The database ID, scientific name, street name, and crown height for trees on located on an “Elm Street”</p></li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Stretch activity
</div>
</div>
<div class="callout-body-container callout-body">
<p>How might you visualize some the datasets you just created? Add some visualizations of these datasets to your Quarto document.</p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link" aria-label="Introduction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Introduction</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./02_reordering.html" class="pagination-link" aria-label="Transforming data">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Transforming data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>