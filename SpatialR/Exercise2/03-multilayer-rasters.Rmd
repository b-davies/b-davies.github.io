# Multilayer rasters

## Reading in a multilayer raster dataset

This time we'll look at some satellite imagery from the eastern shore of Lake Turkana, taken in January 2020. 

```{r }
#Import the northTurkana.tif raster 
eastTurkana<-rast("eastTurkana.tif")
```

Once again, let's look at the attributes:

```{r }
#Examine the data attributes
eastTurkana
```
 
This is similar to the last dataset except for one important detail: there are 4 layers in this dataset. In the `names` area, we can see these are *blue*, *green*, *red*, and *nir* (which stands for "near-infrared). We can look at each of these with `plot`.

## Plotting

```{r}
plot(eastTurkana)
```

The names of the layers are different colors, but these are sensor values of surface reflectance in these different spectra, so R just plots them all on a similar scale. If we wanted to just plot one layer, we can use double brackets `[[]]` and call it by its number in the layer order.

```{r}
#Plot just the red
plot(eastTurkana[[3]])
```

Or we can use single brackets `[]` and call it by it's name in quotation marks. 

```{r}
#Plot just the red another way
plot(eastTurkana['red'])
```

If plotting a "red" layer without using the color red is bothering you as much as it bothers me, we'll need to look at using `RColorBrewer`, specifically the `brewer.pal` function. This takes two arguments: a number and a 'palette'. In this case, we're going to use the "Reds" palette.

```{r}
#Plot reds as reds
plot(eastTurkana['red'],col=brewer.pal(9,"Reds"))

```

You can read more about the different approaches to color, including the RColorBrewer palettes, at [this page](https://bootstrappers.umassmed.edu/bootstrappers-courses/pastCourses/rCourse_2016-04/Additional_Resources/Rcolorstyle.html) 

## Raster algebra

These sensor reflectance values, called "digital numbers", are highly exaggerated. To convert them to reasonable reflectance values, we need to divide them by 10000. 

```{r}
#Divide raster values by 10000
eastTurkana2<-eastTurkana/10000
#
plot(eastTurkana2)
```

We can also do raster math using the different layers of this dataset. For example, let's say we were interested in calculating the [Normalized Difference Vegetation Index](https://gisgeography.com/ndvi-normalized-difference-vegetation-index/): a measure of vegetation greenness that is used as an indicator of vegetation cover. The equation for this is *NDVI = (NIR — RED)/(NIR + RED)*.

Two make things simple, we'll get rasters: one for red, and one for near infrared.

```{r}
red<-eastTurkana2['red']
nir<-eastTurkana2['nir']

plot(red)
plot(nir)
```

Now, we can insert them into the equation for NDVI:

```{r}
ndvi<-(nir-red)/(nir+red)
plot(ndvi)
```


Generally speaking, the higher the value, the greener the vegetation. Values below 0 are bare rock or water. In this image of a semi-arid landscape, greener values tend to be along stream lines and in areas that hold water. 

## Try it yourself!

Use the eastTurkana dataset to do the following:

* Plot the green and blue bands using an appropriate color palette. 
* Another measurement like NDVI is the Normalized Difference Water Index. The formula for this is *NDWI = (GREEN – NIR) / (GREEN + NIR)*. Create subsets for the green and near infrared layers and then create this index. Plot it. Where are the highest values? Are any values over 0.3 (the minimum threshold for water surface)?
* What is the coordinate reference system of the eastTurkana dataset? 
