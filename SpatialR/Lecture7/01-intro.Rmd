# Working with point data in `spatstat`

There are two principal objects required for analyzing point data in `spatstat`: 

* a set of points expressed as coordinates in 2D space (a `ppp` object)
* a window of observation delineating where (an `owin` object)

Points can come from a number of sources. Here, we'll create some data and convert them into a `ppp` object.

```{r}
x<-runif(100,0,1)
y<-runif(100,0,1)
xy<-data.frame(x,y)
w<-owin(c(min(x),max(x)),c(min(y),max(y)))
data<-as.ppp(xy,w)
```



```{r}
plot(data)
```
## Converting `sf` data to `owin` and `ppp`

An important thing to keep in mind about point data analysis in `spatstat` is that it is concerned with distance relationships in two-dimensions. This means that any data that is not in a flat-plane coordinate space will not work. So for us to use `spatstat`, our data must either exist in a non-geographic space (as in our random points above), or must be in a projected coordinate space.

Here, we'll load in 

```{r}
ecuador<-read_sf("ecuador.shp")
ecuador<-st_transform(ecuador,32717)
ecWin<- as.owin(ecuador)
ecWin
```


When making point data
```{r}
primates<-read_sf("SAPrimateObservations.csv")
primates<-subset(primates,countryCode=="EC")
primates<-st_as_sf(primates,coords=c("decimalLongitude","decimalLatitude"))
st_crs(primates)<-4326
primates<-st_transform(primates,32717)
```

OK, let's make sure that's in good shape:

```{r}
g1<-ggplot() +
  geom_sf(data=ecuador) +
  geom_sf(data=primates)
print(g1)
```
Oops! Apparently someone observed primates out in the Galapagos! We'll want to trim those points out before we convert.

```{r}
primates<-st_crop(primates,ecuador)
```


```{r}
g1<-ggplot() +
  geom_sf(data=ecuador) +
  geom_sf(data=primates)
print(g1)
```

That's better. OK, to turn this `sf` into a `ppp` object, we'll use `as.ppp`. 

```{r}
primatesPoints<-as.ppp(primates)
```

Note that warning. "Marks" is point pattern analysis slang for attributes. Our primates data has quite a few of them. Traditionally, `spatstat` only allowed for a single column  of marks, so when it converts other data to `ppp` it only keeps the first column.

Let's take a look at that pattern now. 

```{r}
plot(primatesPoints)
```

Yikes, what a mess. Here, `spatstat` is trying to plot all of the marks that came over with this data. This isn't really something we want to deal with at the moment, so we can get rid of them with `unmark`.

```{r}
primatesPoints<-unmark(primatesPoints)
```


```{r}
plot(primatesPoints)
```


Much better!

## What is a `owin` object? What is a `ppp` object?

These objects are not something we've encountered before, so it's worth looking at their structure a bit. The `owin` carries a few pieces of information that relate to its geometry, such as whether it is a rectangle or polygon, its extent, and the vertices that form its boundary.

```{r}
ecWin$type
```



```{r}
primatesPoints$n
head(primatesPoints$x)
```

If a `ppp` object has marks, these would be stored as a vector or, in the case of more than one set of marks, a dataframe. 

Finally, it also carries its own window object:

```{r}
plot(primatesPoints$window)
```

Of course, here it is just the rectangular extent of the points. But much of the space this rectangle occupies would not really be considered the area of interest. This is what we need the `ecWin` object for: so we can assign a custom window to the point pattern.

```{r}
primatesPoints$window<-ecWin
plot(primatesPoints)
```






